<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  
  
  <title> Quiz ‚Äì 4. Thermodynamic process</title>
  
  
  <style>
    body{font-family:Arial, sans-serif;padding:20px;background:#121212;color:#f0f0f0;}
    #logo{display:block;margin:0 auto 25px;max-width:180px;}
    #name-container{background:#1e1e1e;padding:30px;border-radius:6px;max-width:420px;margin:0 auto;}
    #name-container input{width:100%;padding:10px;margin:10px 0 15px;border:none;border-radius:4px;font-size:16px;}
    #quiz-container{display:none;}
    .question{border:1px solid #333;padding:15px;margin-bottom:20px;border-radius:5px;background:#1e1e1e;}
    .question h3{margin:0 0 10px;}
    .option-item { display: flex; align-items: center; gap: 8px; margin: 6px 0; padding: 6px 8px; border-radius: 4px; background: #2a2a2a; color: #ccc; cursor: pointer; }
    .option-item input[type="radio"] { margin: 0; }
    .submit-button,.toggle-button,.dontknow-button{margin-top:10px;padding:6px 12px;background:#007BFF;color:#fff;border:none;border-radius:4px;cursor:pointer;margin-right:5px;}
    .solution{display:none;margin-top:10px;background:#2d2d2d;padding:10px;border-left:4px solid #28a745;}
    #scorecard{background:#2d2d2d;padding:15px;border-radius:6px;margin-top:30px;display:none;}
    #timer{font-weight:bold;color:#00ffcc;}
    #studentPrintName{text-align:center;font-size:18px;font-weight:bold;margin-top:-15px;margin-bottom:5px;display:none;}
    #examDateTime{text-align:center;font-size:14px;margin-bottom:20px;display:none;}
    @media print {
      body { background: #fff; color:#000; }
      .submit-button, .dontknow-button, .toggle-button, #reportBtn, #reportModal { display:none !important; }
      #name-container { display:none !important; }
    }
    #reportBtn { position: fixed; bottom: 20px; right: 20px; background: #ff4757; color: white; border: none; padding: 12px 18px; border-radius: 50px; cursor: pointer; font-weight: bold; box-shadow: 0px 4px 10px rgba(0,0,0,0.3); z-index: 1000; }
    #reportModal { display: none; position: fixed; bottom: 80px; right: 20px; background: #1e1e1e; border: 1px solid #444; padding: 15px; border-radius: 8px; width: 260px; z-index: 1001; }
    #reportModal textarea { width: 100%; height: 80px; padding: 8px; border: none; border-radius: 4px; resize: none; font-size: 14px; }
    #reportModal button { margin-top: 10px; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; }
    #sendReport { background: #28a745; color: white; }
    #closeReport { background: #dc3545; color: white; margin-left: 5px; }
  </style>

  <!-- MathJax Configuration -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['\\(','\\)'], ['$', '$']], 
        displayMath: [['$$','$$'], ['\\[','\\]']],
        processEscapes: true
      },
      options: { skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre'] }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>
<body>

<img id="logo" src="https://i.ibb.co/WNZTWPwv/LOGO-PNG-2025-fab.png" alt="Logo" />

<div id="studentPrintName"></div>
<div id="examDateTime"></div>

<div id="name-container">
  <h2>Enter your name to begin</h2>
  <input type="text" id="studentNameInput" placeholder="Your Name" />
  <button class="submit-button" onclick="startQuiz()">Start Quiz</button>
</div>

<div id="quiz-container">


  <h2> Quiz ‚Äì 4. Thermodynamic process</h2>
  
  
  <p><strong>Time Elapsed:</strong> <span id="timer">00:00</span></p>
  <div id="questions-container"></div>

  <div style="margin-top:30px;">
    <button class="submit-button" onclick="finalSubmit()">Final Submit</button>
    <button class="submit-button" onclick="printQuestions()">Print Questions</button>
    <button class="submit-button" id="printScoreBtn" onclick="printScorecard()" style="display:none;">Save or Print Scorecard</button>
    <button class="submit-button" id="shareWhatsappBtn" style="display:none;">SHARE on WhatsApp</button>
  </div>

 <div id="scorecard">
  <h3>Your Scorecard</h3>
  <p id="scoreText"></p>
  <table id="scoreTable" border="1" cellspacing="0" cellpadding="6" style="width:100%;border-collapse:collapse;margin-top:15px;">
    <thead style="background:#333;color:#fff;">
      <tr>
        <th>Q.No</th>
        <th>Question</th>
        <th>Your Answer</th>
        <th>Correct Answer</th>
        <th>Result</th>
        <th>Solution</th>
      </tr>
    </thead>
    <tbody id="scoreDetails"></tbody>
  </table>
</div>

<button id="reportBtn">Report Mistake</button>

<div id="reportModal">
  <textarea id="reportMsg" placeholder="Describe the mistake..."></textarea>
  <div style="text-align:right;">
    <button id="sendReport">Send</button>
    <button id="closeReport">Close</button>
  </div>
</div>

<script>


const Q = [
  {
    "id": "q1",
    "text": "An isothermal process is one in which:",
    "options": [
      "A) Temperature remains constant",
      "B) Pressure remains constant",
      "C) Volume remains constant",
      "D) Heat exchanged is zero"
    ],
    "correct": "A",
    "solution": "By definition, an isothermal process is carried out at constant temperature ($T=$ constant).",
    "solution_steps": [
      "Step 1: 'Iso-' means constant; isothermal ‚Üí temperature constant.",
      "Step 2: Other variables (P, V, Q, W) may change while $T$ stays the same.",
      "Step 3: Therefore option (A) is correct."
    ]
  },
  {
    "id": "q2",
    "text": "For an ideal gas undergoing an isothermal process, the change in internal energy $\\Delta U$ is:",
    "options": [
      "A) $0$",
      "B) $n C_V \\Delta T$ (nonzero in general)",
      "C) Equal to the heat $Q$ only if process is irreversible",
      "D) Equal to $-W$ only for adiabatic process"
    ],
    "correct": "A",
    "solution": "For an ideal gas internal energy depends only on temperature. In an isothermal process $\\Delta T=0$, so $\\Delta U=0$; hence $Q=W$ (by first law).",
    "solution_steps": [
      "Step 1: For an ideal gas, $U=U(T)$ so $\\Delta U = n C_V \\Delta T$.",
      "Step 2: In isothermal $\\Delta T=0 \\Rightarrow \\Delta U=0$.",
      "Step 3: First law gives $Q = W$ for the process."
    ]
  },
  {
    "id": "q3",
    "text": "An adiabatic process is one in which:",
    "options": [
      "A) No heat is exchanged with surroundings ($Q=0$)",
      "B) Temperature remains constant",
      "C) Pressure remains constant",
      "D) Work done is zero"
    ],
    "correct": "A",
    "solution": "An adiabatic process has no heat transfer between system and surroundings, so $Q=0$. Energy change appears as work (or change in internal energy).",
    "solution_steps": [
      "Step 1: 'Adiabatic' means without heat exchange.",
      "Step 2: First law: $\\Delta U = Q - W$; if $Q=0$ then $\\Delta U = -W$.",
      "Step 3: Hence option (A) is correct."
    ]
  },
  {
    "id": "q4",
    "text": "For a reversible adiabatic process of an ideal gas (quasi-static, no heat exchange), which relation holds?",
    "options": [
      "A) $P V^{\\gamma} = \\text{constant}$",
      "B) $P V = \\text{constant}$",
      "C) $T V = \\text{constant}$",
      "D) $P T = \\text{constant}$"
    ],
    "correct": "A",
    "solution": "For a reversible (isentropic) adiabatic process of an ideal gas, $PV^{\\gamma}=\\text{constant}$ where $\\gamma = C_P/C_V$.",
    "solution_steps": [
      "Step 1: For reversible adiabatic (no entropy change) and ideal gas, $PV^{\\gamma}=\\text{const}$.",
      "Step 2: Isothermal would give $PV=\\text{const}$ (option B) ‚Äî that is different.",
      "Step 3: Therefore option (A) is correct."
    ]
  },
  {
    "id": "q5",
    "text": "In an isochoric process (constant volume) for a closed system, which statement is true?",
    "options": [
      "A) Work done $W=0$",
      "B) Heat added $Q$ changes internal energy $\\Delta U$",
      "C) Pressure may change if temperature changes",
      "D) All of the above"
    ],
    "correct": "D",
    "solution": "At constant volume no PV work is done ($W=0$); any heat added changes internal energy ($\\Delta U=Q$); pressure can change through change in temperature.",
    "solution_steps": [
      "Step 1: Work done by expansion $W=\\int P\\,dV$; with $dV=0$ ‚áí $W=0$.",
      "Step 2: First law gives $\\Delta U = Q - W = Q$.",
      "Step 3: For an ideal gas at fixed $V$, $P\\propto T$, so $P$ changes with $T$.",
      "Step 4: Hence (D) is correct."
    ]
  },
  {
    "id": "q6",
    "text": "For an isobaric process (constant pressure) the work done by the system when volume changes from $V_1$ to $V_2$ is:",
    "options": [
      "A) $P\\,(V_2 - V_1)$",
      "B) $\\int_{V_1}^{V_2} \\! P\\,dV$ but not equal to $P\\Delta V$",
      "C) Zero because pressure is constant",
      "D) $-P\\,(V_2 - V_1)$"
    ],
    "correct": "A",
    "solution": "When pressure is constant, work done by the system is $W=\\int_{V_1}^{V_2}P\\,dV = P(V_2-V_1)$ (positive for expansion).",
    "solution_steps": [
      "Step 1: General expression for work: $W=\\int_{V_1}^{V_2} P\\,dV$.",
      "Step 2: If $P$ is constant, pull $P$ outside the integral: $W = P\\,(V_2-V_1)$.",
      "Step 3: Sign convention: positive when system does work on surroundings (expansion)."
    ]
  },
  {
    "id": "q7",
    "text": "For a cyclic process carried out by a system (returns to initial state), the net change in internal energy $\\Delta U$ over one cycle is:",
    "options": [
      "A) Positive",
      "B) Negative",
      "C) Zero",
      "D) Depends on path"
    ],
    "correct": "C",
    "solution": "Internal energy $U$ is a state function. If the system returns to the initial state after a cycle, $\\Delta U=0$ irrespective of the path.",
    "solution_steps": [
      "Step 1: $U$ depends only on state; for a closed cycle initial and final states coincide.",
      "Step 2: Therefore $\\Delta U = U_{final} - U_{initial} = 0$.",
      "Step 3: Option (C) is correct."
    ]
  },
  {
    "id": "q8",
    "text": "In a cyclic process the net heat absorbed by the system over one complete cycle is equal to:",
    "options": [
      "A) Net change in internal energy $\\Delta U$",
      "B) Net work done by the system $W_{\\text{net}}$",
      "C) Zero always",
      "D) Negative of net work done by the system"
    ],
    "correct": "B",
    "solution": "First law: over a cycle $\\Delta U=0$, so net heat absorbed $Q_{\\text{net}} = W_{\\text{net}}$ (heat absorbed equals work done by system).",
    "solution_steps": [
      "Step 1: First law: $\\Delta U = Q - W$.",
      "Step 2: For a cycle $\\Delta U = 0$ ‚áí $Q = W$ (both net values over the cycle).",
      "Step 3: Hence option (B) is correct."
    ]
  },
  {
    "id": "q9",
    "text": "A reversible process is characterized by which of the following (idealized) statements?",
    "options": [
      "A) It proceeds infinitely slowly through a sequence of equilibrium states and produces no entropy within the universe (\\(\\Delta S_{\\text{univ}}=0\\))",
      "B) It proceeds rapidly and generates entropy",
      "C) It is always adiabatic",
      "D) It always requires no work"
    ],
    "correct": "A",
    "solution": "A reversible process is quasi-static and produces no entropy within the universe; it is an idealization. Real processes are irreversible and produce entropy (>0).",
    "solution_steps": [
      "Step 1: Reversible = quasi-static and no internal dissipation.",
      "Step 2: Entropy production for universe is zero for reversible change: $\\Delta S_{\\text{univ}}=0$.",
      "Step 3: Options (B),(C),(D) are incorrect generalizations. So (A) is correct."
    ]
  },
  {
    "id": "q10",
    "text": "An irreversible process differs from a reversible one primarily because:",
    "options": [
      "A) Irreversible processes always conserve entropy",
      "B) Irreversible processes generate entropy within the universe ($\\Delta S_{\\text{univ}}>0$)",
      "C) Irreversible processes are quasi-static",
      "D) Irreversible processes are hypothetical and cannot occur"
    ],
    "correct": "B",
    "solution": "Irreversible processes produce entropy; for a spontaneous irreversible change the entropy of the universe increases ($\\Delta S_{\\text{univ}}>0$).",
    "solution_steps": [
      "Step 1: Second law: for any real irreversible process, $\\Delta S_{\\text{univ}} > 0$.",
      "Step 2: Irreversible processes are not quasi-static and involve dissipative effects.",
      "Step 3: Therefore (B) is correct."
    ]
  },
  {
    "id": "q11",
    "text": "On a $P$‚Äì$V$ diagram the work done by the system when it expands from $V_1$ to $V_2$ is represented by:",
    "options": [
      "A) The area under the curve $P(V)$ between $V_1$ and $V_2$ (positive for expansion)",
      "B) The vertical distance between $P(V_1)$ and $P(V_2)$",
      "C) The area above the curve between $V_1$ and $V_2$",
      "D) Zero for any process"
    ],
    "correct": "A",
    "solution": "Work done by the system is $W=\\int_{V_1}^{V_2} P\\,dV$: geometrically it is the area under the $P$ vs $V$ curve between the two volumes (positive on expansion).",
    "solution_steps": [
      "Step 1: Definition: $W=\\int_{V_1}^{V_2} P\\,dV$ (work done by system).",
      "Step 2: Graphically this is area under $P$‚Äì$V$ curve from $V_1$ to $V_2$.",
      "Step 3: Sign convention: expansion ($V_2>V_1$) gives positive $W$."
    ]
  },
  {
    "id": "q12",
    "text": "For a reversible adiabatic (isentropic) process of an ideal gas, the relation between temperature $T$ and volume $V$ is:",
    "options": [
      "A) $T V^{\\gamma-1} = \\text{constant}$",
      "B) $T V = \\text{constant}$",
      "C) $T P = \\text{constant}$",
      "D) $T = \\text{constant}$"
    ],
    "correct": "A",
    "solution": "Reversible adiabatic (isentropic) relations for an ideal gas include $PV^{\\gamma}=\\text{const}$ and $T V^{\\gamma-1}=\\text{const}$, where $\\gamma=C_P/C_V$.",
    "solution_steps": [
      "Step 1: From $PV^{\\gamma}=\\text{const}$ and ideal gas law $PV=RT$, eliminate $P$ to get $T V^{\\gamma-1}=\\text{const}$.",
      "Step 2: Option (B) is isothermal, (D) also isothermal; hence (A) is correct."
    ]
  },
  {
    "id": "q13",
    "text": "Among all processes connecting the same initial and final equilibrium states of a system, a reversible process (ideal) does which of the following regarding work done by the system?",
    "options": [
      "A) Gives the maximum work done by the system (for expansion) compared to any irreversible path",
      "B) Gives the minimum work done by the system (for expansion)",
      "C) Work is independent of path so same for all processes",
      "D) Always gives zero work"
    ],
    "correct": "A",
    "solution": "For a given change of state, the reversible (quasi-static, non-dissipative) path yields the maximum work output for an expansion; irreversible processes dissipate energy and yield less work.",
    "solution_steps": [
      "Step 1: Irreversible processes involve dissipative losses (friction, turbulence), reducing useful work.",
      "Step 2: Reversible (ideal) path avoids dissipation and therefore allows maximum extractable work.",
      "Step 3: Thus option (A) is correct (equivalently, reversible compression requires the minimum work input)."
    ]
  },
  {
    "id": "q14",
    "text": "Consider free expansion of an ideal gas into vacuum (Joule expansion). Which statements are true?",
    "options": [
      "A) No work is done ($W=0$) and no heat exchanged ($Q=0$)",
      "B) Internal energy change $\\Delta U=0$ for ideal gas (so temperature unchanged)",
      "C) Process is irreversible and entropy of the universe increases",
      "D) All of the above"
    ],
    "correct": "D",
    "solution": "In free expansion into vacuum $W=0$, $Q=0$, so for ideal gas $\\Delta U=0$ and $T$ remains constant; process is irreversible and entropy increases because of spontaneous mixing into larger volume.",
    "solution_steps": [
      "Step 1: Free expansion ‚áí gas does no work (no external pressure to work against), $W=0$.",
      "Step 2: Adiabatic (no heat exchange) so $Q=0$; first law gives $\\Delta U=0$ ‚áí ideal gas $T$ constant.",
      "Step 3: The process is irreversible (cannot be reversed without external change) ‚áí $\\Delta S_{\\text{univ}}>0$.",
      "Step 4: Therefore (D) is correct."
    ]
  },
  {
    "id": "q15",
    "text": "When an ideal gas is heated at constant volume (isochoric process), which of the following is true?",
    "options": [
      "A) Work done $W=0$",
      "B) $\\Delta U = Q$",
      "C) Pressure increases if temperature increases",
      "D) All of the above"
    ],
    "correct": "D",
    "solution": "At constant volume no PV work occurs, so $W=0$ and $\\Delta U=Q$. For an ideal gas at fixed $V$, pressure is proportional to temperature, so it increases when $T$ increases.",
    "solution_steps": [
      "Step 1: Work $W=\\int P\\,dV$; with $dV=0$ ‚áí $W=0$.",
      "Step 2: First law $\\Delta U = Q - W = Q$.",
      "Step 3: Ideal gas law $P V = n R T$ with $V$ fixed ‚áí $P\\propto T$, so $P$ increases when $T$ increases.",
      "Step 4: Hence (D) is correct."
    ]
  }
]

;



let student = '';
let timerHandle;
let printMode = '';
let examDateTime = '';

const quizTitle = document.title.split("Quiz")[1]?.trim() || document.title;

function startQuiz() {
  const name = document.getElementById('studentNameInput').value.trim();
  if (!name) { alert('Please enter your name.'); return; }
  student = name;
  examDateTime = new Date().toLocaleString();
  document.getElementById('name-container').style.display = 'none';
  document.getElementById('quiz-container').style.display = 'block';
  buildQuestions();
  if (window.MathJax) MathJax.typesetPromise();
  startTimer();
}

function buildQuestions() {
  const out = document.getElementById('questions-container');
  out.innerHTML = '';

  Q.forEach((q, index) => {
    const qText = q.text || q.question || q.prompt || ''; // tolerate different keys

    // Normalize options into an ordered array of [letter, optionText]
    let entries = [];
    if (Array.isArray(q.options)) {
      entries = q.options.map((opt, i) => [String.fromCharCode(65 + i), opt]);
    } else if (q.options && typeof q.options === 'object') {
      const keys = Object.keys(q.options);
      const keysAreLetters = keys.every(k => /^[A-Z]$/.test(k));
      if (keysAreLetters) {
        keys.sort();
        entries = keys.map(k => [k, q.options[k]]);
      } else {
        entries = keys.map((k, i) => [String.fromCharCode(65 + i), q.options[k]]);
      }
    }

    const optionsHTML = entries.map(([letter, opt]) => {
      return `<label class="option-item" for="${q.id}-${letter}">
                <input type="radio" id="${q.id}-${letter}" name="${q.id}" value="${letter}" onchange="enableSubmit('${q.id}')">
                ${letter}. ${opt}
              </label>`;
    }).join('');

    const imageHTML = q.image ? `<div><img src="${q.image}" alt="figure" style="max-width:360px; margin:10px 0; display:block;"></div>` : '';

    // Handle solution steps if they exist
let solutionStepsHTML = '';
if (q.solution_steps && Array.isArray(q.solution_steps) && q.solution_steps.length > 0) {
  solutionStepsHTML = '<ul style="margin-top:10px;">' +
    q.solution_steps.map(step => {
      if (step.includes("\n")) {
        return `<li><pre style="background:#111; padding:6px; border-radius:4px; overflow-x:auto;">${step}</pre></li>`;
      }
      return `<li>${step}</li>`;
    }).join('') +
    '</ul>';
}


    out.insertAdjacentHTML('beforeend', `
      <div class="question" id="${q.id}-wrap">
        <h3>Q${index + 1}. ${qText}</h3>
        ${imageHTML}
        <div class="options">${optionsHTML}</div>
        <div id="${q.id}-buttons">
          <button id="sub-${q.id}" class="submit-button" disabled onclick="grade('${q.id}')">Submit</button>
          <button class="dontknow-button" onclick="skip('${q.id}')">I Don‚Äôt Know</button>
        </div>
        <button class="toggle-button" id="btn-sol-${q.id}" style="display:none;" onclick="toggleSolution('sol-${q.id}')">Show Solution</button>
        <div class="solution" id="sol-${q.id}">
          <strong>Solution:</strong> ${q.solution || ''} ${solutionStepsHTML}
        </div>
      </div>
    `);
  });

  if (window.MathJax && typeof MathJax.typesetPromise === 'function') MathJax.typesetPromise();
}



function enableSubmit(qid) { document.getElementById(`sub-${qid}`).disabled = false; }

function grade(qid) {
  const q = Q.find(x => x.id === qid);
  // accept different possible field names for the correct answer
  const correct = q.correct || q.answer || q.key || q.correctAnswer;
  const chosen = document.querySelector(`input[name="${qid}"]:checked`);
  if (!chosen) return;

  // lock options
  document.querySelectorAll(`input[name="${qid}"]`).forEach(i => i.disabled = true);

  // the chosen label
  const chosenLabel = chosen.closest('label.option-item');

  // find input that matches the correct letter
  const correctInput = document.querySelector(`input[name="${qid}"][value="${correct}"]`);
  const correctLabel = correctInput ? correctInput.closest('label.option-item') : null;

  if (chosen.value === correct) {
    // correct
    if (chosenLabel) {
      chosenLabel.style.background = '#28a745';
      chosenLabel.style.color = '#fff';
    }
  } else {
    // wrong: mark chosen red, mark correct green (if found)
    if (chosenLabel) {
      chosenLabel.style.background = '#dc3545';
      chosenLabel.style.color = '#fff';
    }
    if (correctLabel) {
      correctLabel.style.background = '#28a745';
      correctLabel.style.color = '#fff';
    }
  }

  // show solution immediately
  const solElem = document.getElementById(`sol-${qid}`);
  if (solElem) solElem.style.display = "block";

  // hide the buttons for this question
  const buttons = document.getElementById(`${qid}-buttons`);
  if (buttons) buttons.style.display = "none";
  const btnSol = document.getElementById(`btn-sol-${q.id}`);
  if (btnSol) btnSol.style.display = "none";

  // re-typeset MathJax for solution if it contains LaTeX
  if (window.MathJax && typeof MathJax.typesetPromise === 'function') MathJax.typesetPromise();
}


function skip(qid) { document.querySelectorAll(`input[name="${qid}"]`).forEach(r => r.disabled = true); showSolutionButton(qid); }
function showSolutionButton(qid) { document.getElementById(`btn-sol-${qid}`).style.display = 'inline-block'; document.getElementById(`${qid}-buttons`).style.display = 'none'; }
function toggleSolution(id) { const elem = document.getElementById(id); elem.style.display = elem.style.display === 'block' ? 'none' : 'block'; }

function startTimer() {
  const display = document.getElementById('timer');
  const started = Date.now();
  timerHandle = setInterval(() => { const s = Math.floor((Date.now() - started) / 1000); display.textContent = `${String((s / 60) | 0).padStart(2,'0')}:${String(s % 60).padStart(2,'0')}`; }, 1000);
}

function finalSubmit() {
  clearInterval(timerHandle);
  document.querySelectorAll("input[type=radio]").forEach(r => r.disabled = true);
  document.querySelectorAll(".submit-button, .dontknow-button").forEach(btn => btn.style.display = "none");

  let totalMarks = 0;
  let negativeMarks = 0;
  let possibleMarks = Q.length * 4;
  let detailHTML = '';

  Q.forEach((q, index) => {
    const checked = document.querySelector(`input[name="${q.id}"]:checked`);
    const chosen = checked ? checked.value : null;

    const correctLetter = q.correct || q.answer || q.key || q.correctAnswer;

    let marks = 0;
    let resultText = "";

    if (chosen === null) {
      marks = 0;
      resultText = "‚ö™ Not Attempted / I Don‚Äôt Know (0)";
    } else if (chosen === correctLetter) {
      marks = 4;
      resultText = "‚úÖ Correct (+4)";
    } else {
      marks = -1;
      resultText = "‚ùå Incorrect (-1)";
    }

    totalMarks += marks > 0 ? marks : 0;
    negativeMarks += marks < 0 ? marks : 0;

    let solutionStepsHTML = '';
    if (q.solution_steps && Array.isArray(q.solution_steps) && q.solution_steps.length > 0) {
      solutionStepsHTML = '<ul style="margin-top:5px;">' +
        q.solution_steps.map(step => `<li>${step}</li>`).join('') +
        '</ul>';
    }

    detailHTML += `
      <tr>
        <td>${index + 1}</td>
        <td>${q.text || q.question}</td>
        <td>${chosen || 'Not Answered'}</td>
        <td>${correctLetter}</td>
        <td>${resultText}</td>
        <td>${q.solution || ''}${solutionStepsHTML}</td>
        <td>${marks}</td>
      </tr>`;
  });

  const finalScore = totalMarks + negativeMarks;

  document.getElementById('scoreText').innerHTML = `${student}, here is your result:`;
  document.getElementById('scoreDetails').innerHTML = detailHTML;

  const summaryHTML = `
    <div style="margin-top:20px; font-weight:bold;">
      <p>Total Marks (Possible): ${possibleMarks}</p>
      <p>Total Marks (Correct Answers): ${totalMarks}</p>
      <p>Negative Marks (Wrong Answers): ${negativeMarks}</p>
      <p>Final Score: ${finalScore}</p>
    </div>
  `;
  document.getElementById('scorecard').insertAdjacentHTML('beforeend', summaryHTML);

  document.getElementById('scorecard').style.display = 'block';
  document.getElementById('printScoreBtn').style.display = 'inline-block';
  document.getElementById('shareWhatsappBtn').style.display = 'inline-block';

  if (window.MathJax && typeof MathJax.typesetPromise === 'function') MathJax.typesetPromise();
}






function printQuestions() { printMode = "questions"; window.print(); }
function printScorecard() { document.getElementById("studentPrintName").innerText = student; document.getElementById("examDateTime").innerText = "Exam Date & Time: " + examDateTime; printMode = "scorecard"; window.print(); }

window.addEventListener('beforeprint', () => {
  if (printMode === "questions") { document.querySelector("#questions-container").style.display = "block"; document.querySelector("#scorecard").style.display = "none"; document.querySelector("#logo").style.display = "none"; document.querySelector("#name-container").style.display = "none"; document.querySelector("#timer").style.display = "none"; document.querySelector("#studentPrintName").style.display = "none"; document.querySelector("#examDateTime").style.display = "none"; }
  if (printMode === "scorecard") { document.querySelector("#questions-container").style.display = "none"; document.querySelector("#scorecard").style.display = "block"; document.querySelector("#logo").style.display = "block"; document.querySelector("#name-container").style.display = "none"; document.querySelector("#studentPrintName").style.display = "block"; document.querySelector("#examDateTime").style.display = "block"; }
});
window.addEventListener('afterprint', () => { document.querySelector("#questions-container").style.display = ""; document.querySelector("#scorecard").style.display = ""; document.querySelector("#logo").style.display = ""; document.querySelector("#name-container").style.display = ""; document.querySelector("#timer").style.display = ""; document.querySelector("#studentPrintName").style.display = "none"; document.querySelector("#examDateTime").style.display = "none"; });




document.getElementById("shareWhatsappBtn").addEventListener("click", function () {
  const whatsappNumber = "9108069409455";

  if (!student) {
    alert("Please complete the quiz first.");
    return;
  }

  const scoreText = document.getElementById('scoreText').innerText || "Result not available";

  let totalMarks = 0;
  let negativeMarks = 0;
  let possibleMarks = Q.length * 4;

  let details = "";

  Q.forEach((q, i) => {
    const qNum = i + 1;
    const checked = document.querySelector(`input[name="${q.id}"]:checked`);
    let userAns = checked ? checked.value : null;
    const correctAns = q.correct || q.answer || q.key || q.correctAnswer;

    let marks = 0;
    let resultText = "";

    if (userAns === null) {
      marks = 0;
      resultText = "‚ö™ Not Attempted / I Don‚Äôt Know (0)";
      userAns = "Not Answered";
    } else if (userAns === correctAns) {
      marks = 4;
      resultText = "‚úÖ Correct (+4)";
    } else {
      marks = -1;
      resultText = "‚ùå Incorrect (-1)";
    }

    totalMarks += marks > 0 ? marks : 0;
    negativeMarks += marks < 0 ? marks : 0;

    details += `Q${qNum} ‚Üí ${resultText} (Your Ans: ${userAns} | Correct: ${correctAns})\n`;
  });

  const finalScore = totalMarks + negativeMarks;

  const message = `Sir, I have shared my Test Result for checking. Thank you!\n\nüìò Quiz Title: ${quizTitle}\nüë§ Student: ${student}\n\n${scoreText}\n\nüìä Summary:\n‚úî Total Marks (Possible): ${possibleMarks}\n‚úî Total Marks (Correct Answers): ${totalMarks}\n‚úî Negative Marks (Wrong Answers): ${negativeMarks}\n‚úî Final Score: ${finalScore}\n\nDetails:\n${details}`;

  const waUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
  window.open(waUrl, "_blank");
});


const reportBtn = document.getElementById("reportBtn");
const reportModal = document.getElementById("reportModal");
const sendReport = document.getElementById("sendReport");
const closeReport = document.getElementById("closeReport");
const reportMsg = document.getElementById("reportMsg");

reportBtn.onclick = () => { reportModal.style.display = "block"; };
closeReport.onclick = () => { reportModal.style.display = "none"; reportMsg.value = ""; };
sendReport.onclick = () => {
  const msg = reportMsg.value.trim();
  if (!msg) { alert("Please write your message before sending."); return; }
  const whatsappNumber = "9108069409455";
  const message = `‚ö†Ô∏è Reported Mistake\n\nüìò Quiz Title: ${quizTitle}\nüë§ Student: ${student || "Anonymous"}\n\nüìù Message:\n${msg}`;
  const waUrl = `https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`;
  window.open(waUrl, "_blank");
  reportModal.style.display = "none";
  reportMsg.value = "";
};
</script>

</body>
</html>
